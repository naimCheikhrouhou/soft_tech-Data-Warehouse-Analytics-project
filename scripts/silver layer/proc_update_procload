-- Enable xp_cmdshell if not already enabled
EXEC sp_configure 'show advanced options', 1;
RECONFIGURE;
EXEC sp_configure 'xp_cmdshell', 1;
RECONFIGURE;
exec dbo.ExecuteAllLoadProcs;

SELECT suser_sname();  -- or check the service in services.msc

CREATE or alter PROCEDURE dbo.ExecuteAllLoadProcs
AS
BEGIN
    SET NOCOUNT ON;

    DECLARE @path NVARCHAR(255) = 'C:\SQL2022\proc_load_tables\'; -- Change this to your folder sql 
    DECLARE @cmd NVARCHAR(4000);

    -- List of SQL files
    DECLARE @files TABLE (file_name NVARCHAR(255));
    INSERT INTO @files(file_name) VALUES
        ('proc_load_candidates.sql'),
        ('proc_load_candidates_cv_raw.sql'),
        ('proc_load_candidates_interview.sql'),
        ('proc_load_customers.sql'),
        ('proc_load_employees.sql'),
        ('proc_load_employees_performance.sql'),
        ('proc_load_products.sql'),
        ('proc_load_projects.sql'),
        ('proc_load_projects_bug_reports.sql'),
        ('proc_load_sales.sql'),
        ('proc_load_teams.sql');

    -- Loop through each file and execute it
    DECLARE file_cursor CURSOR FOR SELECT file_name FROM @files;
    DECLARE @file NVARCHAR(255);

    OPEN file_cursor;
    FETCH NEXT FROM file_cursor INTO @file;

    WHILE @@FETCH_STATUS = 0
    BEGIN
        SET @cmd = 'sqlcmd -S YourServerName -d YourDatabaseName -E -i "' + @path + @file + '"';
        PRINT 'Executing: ' + @cmd;  -- optional log
        EXEC xp_cmdshell @cmd;

        FETCH NEXT FROM file_cursor INTO @file;
    END

    CLOSE file_cursor;
    DEALLOCATE file_cursor;
END
GO
